---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(here)
library(tidytext)
library(plotly)
library(psych)
library(ggExtra)
library(viridis)
library(corrplot)
library(GGally)
library(hrbrthemes)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
data1 <- read_csv(here("data/locations.csv"))
data2 <- read_csv(here("data/Microclimate_Sensor_Locations.csv"))
weather_data <- read_csv(here("data/weather.csv"))
```

```{r}
weather_data <- weather_data %>% 
    mutate(humidity_categoric = factor(
           case_when(
           between(relative_humidity_percent, 0, 30) ~ "low",
           between(relative_humidity_percent, 30, 60) ~ "medium",
           between(relative_humidity_percent, 60, 100) ~ "high"
         ),
         levels = c("low", "medium", "high")
         )) %>% 
    mutate(temp_category = factor(
           case_when(
           between(ambient_temperature_celsius, -20, 10) ~ "low",
           between(ambient_temperature_celsius, 10, 20) ~ "medium",
           between(ambient_temperature_celsius, 20, 100) ~ "high"
         ),
         levels = c("low", "medium", "high")
         )) %>% 
  mutate(time_day = factor(
           case_when(
           between(hour, 5, 12) ~ "Morning",
           between(hour, 12, 18) ~ "Afternoon",
           between(hour, 18, 23) ~ "Evening",
           between(hour, 0, 5) ~ "Night"),
         levels = c("Morning", "Afternoon", "Evening", "Night")
         ))
```

```{r}
pairs.panels(weather_data[11:16], method = "pearson",  # correlation method
             hist.col = "#00AFBB", 
             density = TRUE,  # show density plots
             ellipses = TRUE # show correlation ellipses
             )
```

```{r}
p2 <- weather_data %>% 
  ggplot(aes(ambient_temperature_celsius, relative_humidity_percent, 
             color = as.factor(humidity_categoric)))+
  geom_point(alpha = 0.3)+
    theme_minimal()+
      labs(y = "Relative humidity (Percentage)",
         x = "Ambient temperature (Celsius)",
         title = "Relation between humidity and temperature",
          caption = "Figure 9. Data sourced from World Bank") +
  theme(axis.title.y = element_text(size = 11),
        axis.text.y = element_text(size = 11),
        legend.position = "bottom")+
  scale_fill_viridis(name="Humidity", option ="C")+
  scale_y_continuous(breaks = seq(15, 100, by = 10))+
    scale_x_continuous(breaks = seq(0, 35, by = 5))

ggMarginal(p2, 
           margins = "x", 
           groupColour = TRUE, groupFill = TRUE)
```

```{r}
weather_data %>% 
  ggplot(aes(ambient_temperature_celsius, relative_humidity_percent, 
             color = as.factor(time_day)
             ))+
  geom_point(alpha = 0.3)+
  facet_wrap(~time_day)+
    theme_minimal()+
      labs(y = "Relative humidity (Percentage)",
         x = "Ambient temperature (Celsius)",
         title = "Relation between humidity and temperature",
          caption = "Figure 9. Data sourced from World Bank") +
  theme(axis.title.y = element_text(size = 11),
        axis.text.y = element_text(size = 11),
        legend.position = "bottom")+
  #scale_fill_viridis(name="Humidity", option ="C")+
  scale_y_continuous(breaks = seq(10, 100, by = 20))+
    scale_x_continuous(breaks = seq(0, 35, by = 5))
```


```{r}
weather_data %>% 
  select(relative_humidity_percent, ambient_temperature_celsius, hour, humidity_categoric, temp_category) %>%
  ggparcoord(columns = 1:3, groupColumn = 4,
             alphaLines = 1,
             scale = "uniminmax"
    ) + 
  scale_color_manual(values=c("#E8E8E8", "#69b3a2", "#E8E8E8") ) +
  theme_ipsum()+
  theme(
    plot.title = element_text(size=10)
  )
```


```{r}
weather_data %>% 
  drop_na(temp_category) %>% 
  ggplot(aes(x=temp_category, y=relative_humidity_percent, fill=site_id)) + 
    geom_boxplot()+
  coord_flip()
```

```{r}
p3 <- weather_data %>% 
  #filter(pm2_5<300) %>% 
  ggplot(aes( pm2_5, relative_humidity_percent))+
  geom_point(alpha = 0.3) +
  scale_x_log10()+
    scale_y_continuous(breaks = seq(15, 100, by = 10))+
    #scale_x_continuous(breaks = seq(0, 1100, by = 100))+
    theme(legend.position="bottom")+
      labs(y = "Relative humidity (Percentage)",
         x = "PM 2.5 level (μg/m3)",
         title = "Average relative humidity",
         caption = "Figure 3. Data sourced from City of Melbourne",
         subtitle = "Key finding")+
  theme_minimal()
p3
```

```{r}
weather_data %>% 
  mutate(month = factor(month, levels = month.abb)) %>% 
  group_by(month, day) %>% 
  summarise(average = mean(relative_humidity_percent, na.rm = TRUE)) %>% 
  ggplot(aes(reorder(month, desc(month)), day, fill = average)) +
  geom_tile(color= "white",size=0.1) + 
  theme_classic() +
  scale_fill_viridis(name="Relative humidity (percentage)",option ="C")+
  scale_y_continuous(breaks = seq(1, 31, by = 1))+
  coord_flip()+
    theme(axis.line=element_blank(),
        axis.ticks=element_blank(),
        legend.position="bottom",
          panel.background=element_blank(),
        panel.border=element_blank(),panel.grid.major=element_blank(),
          panel.grid.minor=element_blank(),
        plot.background=element_blank())+
      labs(y = "Day of the month",
         x = "Month",
         title = "Average relative humidity throughout collection period",
         caption = "Data sourced from City of Melbourne",
         subtitle = "Key finding")
```

```{r}
p2 <- weather_data %>% 
  drop_na(humidity_categoric) %>% 
  ggplot(aes(ambient_temperature_celsius, relative_humidity_percent, 
             color = humidity_categoric))+
  geom_point(alpha = 0.3)+
    theme_minimal()+
      labs(y = "Relative humidity (Percentage)",
         x = "Ambient temperature (Celsius)",
         title = "Relation between humidity and temperature",
         subtitle = "The negative association can be observed",
          caption = "Data sourced from City of Melbourne") +
  theme(axis.title.y = element_text(size = 11),
        axis.text.y = element_text(size = 11),
        legend.position = "bottom")+
  scale_fill_manual(name="Humidity")+
  scale_y_continuous(breaks = seq(15, 100, by = 10))+
    scale_x_continuous(breaks = seq(0, 35, by = 5))+
  guides(fill=guide_legend(title="New Legend Title"))

ggMarginal(p2, 
           margins = "x", 
           groupColour = TRUE, groupFill = TRUE)
```

```{r}
p3 <- weather_data %>% 
  #filter(pm2_5<300) %>% 
  ggplot(aes( pm2_5, relative_humidity_percent))+
  geom_point(alpha = 0.1) +
  scale_x_log10()+
    scale_y_continuous(breaks = seq(15, 100, by = 10))+
    #scale_x_continuous(breaks = seq(0, 1100, by = 100))+
    theme(legend.position="bottom")+
      labs(y = "Relative humidity (Percentage)",
         x = "PM 2.5 level (μg/m3)",
         title = "Average relative humidity",
         caption = "Data sourced from City of Melbourne",
         subtitle = "Key finding")+
  theme_minimal()
p3
```

